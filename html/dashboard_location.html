<!--<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
    <html lang="en">
        <!--<![endif]-->
        <head>
            <!-- Basic Page Needs
              ================================================== -->
            <meta charset="utf-8">
            <title>KwikPay Dashboard</title>
            <!-- SEO Meta
              ================================================== -->
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="description" content="">
            <meta name="keywords" content="">
            <meta name="distribution" content="global">
            <meta name="revisit-after" content="2 Days">
            <meta name="robots" content="ALL">
            <meta name="rating" content="8 YEARS">
            <meta name="Language" content="en-us">
            <meta http-equiv="reply-to" content="">
            <meta name="GOOGLEBOT" content="NOARCHIVE">
            <!-- Mobile Specific Metas
              ================================================== -->
            <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
            <!-- CSS
              ================================================== -->
            <link rel="stylesheet" href="css/style.css">
            <link rel="stylesheet" href="css/custom-style.css">
            <link rel="stylesheet" href="css/font-awesome.min.css">
        
            <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
            <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.jqueryui.min.css">
        
            <link href="https://fonts.googleapis.com/css?family=Signika:300,400,700&display=swap" rel="stylesheet">
            <link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
            <link rel="stylesheet" type="text/css" media="all" href="css/daterangepicker.css" />
        
        
        
        
            <!--[if lt IE 9]>
                    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
                <![endif]-->
            <!-- Favicons
                ================================================== -->
            <link rel="shortcut icon" href="images/favicon.ico">
            <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
            <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
            <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
            <!--[if gte IE 9]>
                  <style type="text/css">
                    .gradient {
                       filter: none;
                    }
                  </style>
                <![endif]-->
            <!-- JS
                ================================================== -->
        
            <script src="js/jquery-1.9.1.min.js"></script>
            <script type="text/javascript" src="js/moment.min.js"></script>
            <script type="text/javascript" src="js/dp.js"></script>
        
        
        </head>
        <body>
            <!-- HEADER START -->
            <!-- HEADER END -->
            <!-- CONTAINER START -->
        
            <section>
                <div class="content">
        
                    <div class="row_content">
                        <div class="sidebar_left contentscroll mCustomScrollbar">
                            <div class="left_logo">
                                <a href="#"><img src="images/logo-2.png" /></a>
                            </div>
                            <div class="sidebar_left_menu">
                                <h3>Provider Details<span class="plusminus">-</span></h3>
                                <ul style="display: block;">
                                    <li><a href="#">Provider Details</a></li>
                                    <li><a href="#">Free ride definition</a></li>
                                    <li><a href="#">Free ride duration</a></li>
                                </ul>
                                <h3>Amusement locations <span class="plusminus">+</span></h3>
                                <ul>
                                    <li><a href="#">Amusement locations</a></li>
                                </ul>
        
                                <h3>Sales Data<span class="plusminus">+</span></h3>
                                <ul>
                                    <li><a href="#">Payment transaction</a></li>
                                    <li><a href="#">App transaction data</a></li>
                                    <li><a href="#">Cash collection data</a></li>
                                </ul>
                                <h3>Charts<span class="plusminus">+</span></h3>
                                <ul>
                                    <li><a href="#">Dashboard</a></li>
                                    <li><a href="#">Machine charts</a></li>
                                </ul>
                                <h3>Reports<span class="plusminus">+</span></h3>
                                <ul>
                                    <li><a href="#">Report</a></li>
                                    <li><a href="#">Consolidated report</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="right_wrapper_content">
                            <div class="top_bar">
                                <div class="top_bar_left">
                                    <p>Good afternoon! Game on   Today's Date : 2/12/2019 12:58:27 PM</p>
                                </div>
                                <div class="top_bar_right">
                                    <div class="top_bar_menu">
                                        <a href="#"><span><img src="images/top_icon.png" /></span><i class="fa fa-chevron-down"></i></a>
                                        <ul class="top_bar_down">
                                            <li><a href="#">My profile</a></li>
                                            <li><a href="#">Contact us</a></li>
                                            <li><a href="#">Logout</a></li>
                                        </ul>
                                    </div>
                                </div>
        
                            </div>
                            <div class="wrapper_dashboard_scroll contentscroll mCustomScrollbar">
                                <div class="wrapper_dashboard ">
                                    <div class="titel_location titel_location_noicon"><h1>Dashboard All Location</h1></div>
                                    <div class="inputpicker_content_box button_location_right">
                                        <div class="input_picker_dashboard">
                                            <input type="text" class="form-control demo_picker" />
                                        </div>
                                    </div>
                                    <div class="clear"></div>
                                    <div class="new_location_form1">
                                        <div class="dashboard_row_clear">
                                            <div class="dashboard_left_text1">
                                                <h3>Yesterday - 20/11/2019  </h3>
                                                <div class="dashboard_box_padding">
                                                    <div class="dashboard_center_padding">
                                                        <h4>Active machine</h4>
                                                        <h5>5/10</h5>
                                                    </div>
                                                </div>
                                                <div class="dashboard_box_padding active">
                                                    <div class="dashboard_center_padding">
                                                        <h4>No. of transaction</h4>
                                                        <h5>1,000</h5>
                                                    </div>
                                                </div>
                                                <div class="dashboard_box_padding">
                                                    <div class="dashboard_center_padding">
                                                        <h4>Sales</h4>
                                                        <h5><strong>£ </strong> 100</h5>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dashboard_right_text1">
        
                                                <h3>Current month - <span class="st_date">1/11/2019</span> - <span class="ed_date">25/11/2019</span>   </h3>
                                                <div class="dashboard_box_padding">
                                                    <div class="dashboard_center_padding">
                                                        <h4>Active machine</h4>
                                                        <h5><strong>~ </strong> 5/10</h5>
                                                    </div>
                                                </div>
                                                <div class="dashboard_box_padding">
                                                    <div class="dashboard_center_padding">
                                                        <h4>No. of transaction</h4>
                                                        <h5><strong>~ </strong> 1,000</h5>
                                                    </div>
                                                </div>
                                                <div class="dashboard_box_padding">
                                                    <div class="dashboard_center_padding">
                                                        <h4>Sales</h4>
                                                        <h5><strong>£ </strong> 100</h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="dashboard_row_clear">
                                            <div class="dashboard_chartholder_left">
                                                <div class="dashboard_piechart_left" >
                                                    <div class='canvas_piechart' id='canvas_piechart1'>
                                                        <canvas id="pieChart1" height="360" width="360"></canvas>
                                                    </div>
                                                    <div class="dashboard_machine_margin">
                                                        <h2>Sales</h2>
                                                        <ul class="dashboard_machine_link" style="display: flex; flex-direction: column;">
                                                            <li class="color_bgbox5"><span></span>Cashless sale</li>
                                                            <li class="color_bgbox6"><span></span>Cash sale</li>
                                                        </ul>
                                                    </div>
                                                </div>

                                                <div class="dashboard_piechart_right flex flex-column" id='mainPieRightDiv'>
                                                    <div class='canvas_piechart' id='canvas_piechart'>
                                                        <canvas id="pieChart" height="360" width="360"></canvas>
                                                    </div>
        
                                                    <div class="dashboard_machine_margin">
                                                        <h2>Top 5 machine</h2>
                                                        <ul class="dashboard_machine_link" id = 'fiveMachines'>
                                                            <!-- <li class="color_bgbox1" id = 'one'><span></span> Ring toss</li>
                                                            <li class="color_bgbox2" id = 'two'><span></span> Cruish blast</li>
                                                            <li class="color_bgbox3" id = 'three'><span></span> Air hockey</li>
                                                            <li class="color_bgbox4" id = 'four'><span></span> Peppa pig</li>
                                                            <li class="color_bgbox5" id = 'five'><span></span> Quikdrop</li> -->
                                                        </ul>
                                                    </div>
        
                                                </div>
        
        
                                            </div>
                                            <div class="dashboard_chartholder_right">
                                                <div style=' position: absolute; display: flex;width: 55vw; margin-top: 10;' id='mainSelect'>
                                                    <div class="dashboard_select" id='machineSelect'>
                                                        <div class="custom-select" id='machineCustomSelect'>
                                                            <select id="machine_select">
                                                                <option>All Machines</option>
                                                                <option>All Machines</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="dashboard_select">
                                                        <div class="custom-select1">
                                                            <select id='locations'>
                                                                <option value="0" selected>All Location</option>
                                                                <option value="All Location">All Location</option>
                                                                <!-- <option value="New York">New York</option>
                                                                <option value="southsea arcade">Southsea arcade</option> -->
                                                            </select>
                                                        </div>
                                                    </div>
                                                    
                                                </div>
                                                
        
                                                <div class="dashboard_weekly_right" style='margin-top: 60px;'>
                                                    <div class="dashboard_weekly_titel1 w-full">
                                                        <h3>Weekly Sales / Cash Drop</h3>
                                                    </div>
                                                    <div id='parent_lineChart' >
                                                        <canvas id="lineChart" height="400px" width="600"></canvas>
                                                    </div>
                                                </div>
        
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        
                </div>
        
            </section>
            <!-- CONTAINER END -->
            <!-- FOOTER START -->
        
            <footer> </footer>
        
            <!-- FOOTER END -->
        
        </body>
        
        
        <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
        <script src="js/jquery.dataTables.min.js"></script>
        <script src="js/dataTables.jqueryui.min.js "></script>
        
        
        
        
        <script src="js/app.config.js"></script>
        
        
        
        <script src="js/bootstrap.min.js"></script>
        
        
        <script src="js/app.min.js"></script>
        
        <!-- <script src="js/chart.min.js"></script> -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
        
        
        <!--<script type="text/javascript" src="js/daterangepicker.js"></script>-->
        <script type="text/javascript" src="js/dp.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
        
        <script>
        
        
            $(document).ready(function () {
                $('#example').DataTable();
            });
        
            (function ($) {
                $(window).on("load", function () {
        
                    $("a[rel='load-content']").click(function (e) {
                        e.preventDefault();
                        var url = $(this).attr("href");
                        $.get(url, function (data) {
                            $(".contentscroll .mCSB_container").append(data); //load new content inside .mCSB_container
                            //scroll-to appended content
                            $(".contentscroll").mCustomScrollbar("scrollTo", "h2:last");
                        });
                    });
        
                    $(".contentscroll").delegate("a[href='top']", "click", function (e) {
                        e.preventDefault();
                        $(".contentscroll").mCustomScrollbar("scrollTo", $(this).attr("href"));
                    });
        
                });
            })(jQuery);
        
    window.pieOptions = {
        tooltips: {
            enabled: true
        },
        legend: {
            display: false,
            position: 'bottom'  // <- the important part
        },
        //Boolean - Whether we should show a stroke on each segment
        segmentShowStroke: true,
            //String - The colour of each segment stroke
            segmentStrokeColor: "#fff",
            //Number - The width of each segment stroke
            segmentStrokeWidth: 0,
            //Number - Amount of animation steps
            animationSteps: 100,
            //String - types of animation
            animationEasing: "easeOutBounce",
            //Boolean - Whether we animate the rotation of the Doughnut
            animateRotate: true,
            //Boolean - Whether we animate scaling the Doughnut from the centre
            animateScale: false,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
    };

    window.lineOptions = {
        scales: {
            yAxes: [{
                scaleLabel: {
                    display: true,
                    fontSize: 18,
                    labelString: 'Pounds, £'
                }
            }],
            xAxes: [{
                scaleLabel: {
                    display: true,
                    fontSize: 18,
                    labelString: 'Dates'
                }
            }],
        },
        // scaleShowGridLines: true,
        // scaleGridLineColor: "rgba(0,0,0,.05)",
        // //Number - Width of the grid lines
        // scaleGridLineWidth: 1,
        // //Boolean - Whether the line is curved between points
        // bezierCurve: true,
        // //Number - Tension of the bezier curve between points
        // bezierCurveTension: 0.4,
        // //Boolean - Whether to show a dot for each point
        // pointDot: true,
        // //Number - Radius of each point dot in pixels
        // pointDotRadius: 4,
        // //Number - Pixel width of point dot stroke
        // pointDotStrokeWidth: 1,
        // //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
        // pointHitDetectionRadius: 20,
        // //Boolean - Whether to show a stroke for datasets
        // datasetStroke: true,
        // //Number - Pixel width of dataset stroke
        // datasetStrokeWidth: 3,
        // //Boolean - Whether to fill the dataset with a colour
        // datasetFill: true,
        // //Boolean - Re-draw chart on page resize
        responsive: true,
        //String - A legend template
        maintainAspectRatio: false,
    }

     function selectRun(className) {
        var x, i, j, selElmnt, a, b, c;
        /*look for any elements with the class "custom-select":*/
        x = document.getElementsByClassName(className);
        for (i = 0; i < x.length; i++) {
            selElmnt = x[i].getElementsByTagName("select")[0];
            /*for each element, create a new DIV that will act as the selected item:*/
            a = document.createElement("DIV");
            a.setAttribute("class", "select-selected");
            a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
            x[i].appendChild(a);
            /*for each element, create a new DIV that will contain the option list:*/
            b = document.createElement("DIV");
            b.setAttribute("class", "select-items select-hide");
            for (j = 1; j < selElmnt.length; j++) {
                /*for each option in the original select element,
                create a new DIV that will act as an option item:*/
                c = document.createElement("DIV");
                c.innerHTML = selElmnt.options[j].innerHTML;
                c.addEventListener("click", async function (e) {
                    /*when an item is clicked, update the original select box,
                    and the selected item:*/
                    var y, i, k, s, h;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    h = this.parentNode.previousSibling;
                    for (i = 0; i < s.length; i++) {
                        if (s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            for (k = 0; k < y.length; k++) {
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    window.machineLocation = e.target.innerHTML === 'Southsea arcade' ? 'southsea arcade': e.target.innerHTML
                    //h.click();
                    window.machineChart.allFilters(window.allMachines || 'All Machines', window.machineLocation)
                    // let isCompressed = false;
                    // window.machineLocation = e.target.innerHTML === 'Southsea arcade' ? 'southsea arcade': e.target.innerHTML
                    //         const {ctx, pieCtx, pieCtx1} = window.machineChart.createCanvas();
                    //         console.log(window.allMachines)
                    //         if(window.allMachines !== 'All Machines' && window.allMachines) {
                    //             return window.machineChart.displayOneMachineData(window.allMachines, e.target.innerHTML === 'Southsea arcade' ? 'southsea arcade': e.target.innerHTML);
                    //         }
                    //         if( e.target.innerHTML === 'All Location') {
                    //             await window.machineChart.getDateRange(window.start || moment().subtract(29, 'days'), window.end || moment(), window.dayName || '30DAYS', true, e.target.innerHTML);
                    //         }
                    //         else {
                    //             return window.machineChart.displayOneMachineData(window.allMachines || 'All Machines', e.target.innerHTML === 'Southsea arcade' ? 'southsea arcade': e.target.innerHTML);
                    //         }
                            
                    //         window.machineChart.updateData = { start: window.start, end: window.end, dayName: window.dayName, isCompressed };
                        
                    //         const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                    //         const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                    //         const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);

                });
                b.appendChild(c);
            }
            x[i].appendChild(b);
            a.addEventListener("click", function (e) {
                /*when the select box is clicked, close any other select boxes,
                and open/close the current select box:*/
                e.stopPropagation();
                closeAllSelect(this);
                this.nextSibling.classList.toggle("select-hide");
                this.classList.toggle("select-arrow-active");
            });
        }

        function closeAllSelect(elmnt) {
            /*a function that will close all select boxes in the document,
            except the current select box:*/
            var x, y, i, arrNo = [];
            x = document.getElementsByClassName("select-items");
            y = document.getElementsByClassName("select-selected");
            for (i = 0; i < y.length; i++) {
                if (elmnt == y[i]) {
                    arrNo.push(i)
                } else {
                    y[i].classList.remove("select-arrow-active");
                }
            }
            for (i = 0; i < x.length; i++) {
                if (arrNo.indexOf(i)) {
                    x[i].classList.add("select-hide");
                }
            }
        }

        /*if the user clicks anywhere outside the select box,
        then close all select boxes:*/
        document.addEventListener("click", closeAllSelect);
    }

    function selectUpdate(className, isShow) {
        var x, i, j, selElmnt, a, b, c;
        /*look for any elements with the class "custom-select":*/
        x = document.getElementsByClassName(className);
        for (i = 0; i < x.length; i++) {
            selElmnt = x[i].getElementsByTagName("select")[0];
            b = x[i].getElementsByClassName("select-items")[0];
            b.innerHTML = '';
            for (j = 1; j < selElmnt.length; j++) {
                /*for each option in the original select element,
                create a new DIV that will act as an option item:*/
                c = document.createElement("DIV");
                c.innerHTML = selElmnt.options[j].innerHTML;
                b.appendChild(c);

                c.addEventListener("click", async function (e) {
                    /*when an item is clicked, update the original select box,
                    and the selected item:*/
                    var y, i, k, s, h;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    h = this.parentNode.previousSibling;
                    for (i = 0; i < s.length; i++) {
                        if (s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            for (k = 0; k < y.length; k++) {
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    //h.click();
                    window.allMachines = e.target.innerHTML;
                    window.machineChart.allFilters(window.allMachines, window.machineLocation || 'All Location')
                });
            }
        }
    }

    function selectUpdate1(className, isShow) {
        var x, i, j, selElmnt, a, b, c;
        /*look for any elements with the class "custom-select":*/
        x = document.getElementsByClassName(className);
        for (i = 0; i < x.length; i++) {
            selElmnt = x[i].getElementsByTagName("select")[0];
            b = x[i].getElementsByClassName("select-items")[0];
            b.innerHTML = '';
            for (j = 1; j < selElmnt.length; j++) {
                /*for each option in the original select element,
                create a new DIV that will act as an option item:*/
                c = document.createElement("DIV");
                c.innerHTML = selElmnt.options[j].innerHTML;
                b.appendChild(c);

                c.addEventListener("click", async function (e) {
                    /*when an item is clicked, update the original select box,
                    and the selected item:*/
                    var y, i, k, s, h;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    h = this.parentNode.previousSibling;
                    for (i = 0; i < s.length; i++) {
                        if (s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            for (k = 0; k < y.length; k++) {
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    //h.click();
                    window.machineLocation = e.target.innerHTML;
                    console.log(window.machineLocation )
                    window.machineChart.allFilters(window.allMachines ||  'All Machines', window.machineLocation || 'All Location')
                });
            }
        }
    }

    selectRun('custom-select');
    selectRun('custom-select1');


        
                $('.demo_picker').daterangepicker({
        startDate: moment().subtract(29, 'days'),
        endDate: moment(),
        showCustomRangeLabel: false,
        "ranges": {
            'Last 30 Days': [ moment().subtract(29, 'days'), moment() ],
            '3 Month': [ moment().subtract(3, 'month'), moment() ],
            '6 Month': [ moment().subtract(6, 'month'), moment() ],
        },
    }, async (start, end, label) => {
        //console.log( document.getElementById('canvas_piechart'))
        //document.getElementById('canvas_piechart').remove()
        window.start = start;
        window.end = end;
        let isCompressed = false;

        window.dayName = null
        const {ctx, pieCtx, pieCtx1} = window.machineChart.createCanvas();
        switch (label) {
            case 'Last 30 Days':
            window.dayName = '30DAYS';
                isCompressed = true;
                break;
            case '3 Month':
            window.dayName = '3MONTH';
                isCompressed = true;
                break;
            case '6 Month':
            window.dayName = '6MONTH';
                isCompressed = true;
                break;
            default:
            window.dayName = '30DAYS';
                break;
        }
        await window.machineChart.getDateRange(start, end, window.dayName, isCompressed, 'All Location', true);
        
        window.machineChart.updateData = { start, end, dayName, isCompressed };
       
        // myNewChart.update();
        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
        // const myNewChart = new Chart(ctx, {
        //     type: 'line',
        //     data: window.machineChart.lineData,
        //     options: window.lineOptions
        // });
    });

            (async () => {
              
                function MachineChart(skip) {
                    this.appSales = 0;
                    this.cashSales = 0;
                    this.contactlessSales = 0;
                    this.res = null;
                    this.dates = null;
                    this.lineData = null;
                    this.allData = null;
                    this.skip = skip;
                    this.machineList = [];
                    this.monthsName = ["Jan", "Dec", "Feb",'Mar', "Apr", 'May', "Jun", "Jul", "Aug", "Sep", "Oct", "Nov" ]
        
                    this.getMs = function (date) {
                        return new Date(date).setHours(0, 0, 0, 0);
                    }
                    this.getCorrectDateFormat = function (date) {
                        date = new Date(date);
                        return date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(-2) + '-' + ('0' + (date.getDate())).slice(-2);
                    }

                    this.getChartDateFormat = function (date) {
                        date = new Date(date);
                        console.log(date.getMonth())
                        return ('0' + (date.getDate())).slice(-2) + '-' + this.monthsName[date.getMonth() + 1] + '-' +  (date.getFullYear() + '').slice(-2);
                    }

                    this.fetchData = async function (name) {
                        
                        const reqBody = JSON.stringify({
                            "APISERVICE": 'KP_AMUSEMENT_'+  name + '_CHART_DATA',
                            "LOGIN_USER_ID": "7"
                        })
                        const response = await fetch('https://api.kwikpay.be/kwikpayapi/jsonrequest', {
                            method: 'POST',
                            header: 'Content-Type: application/json',
                            body: reqBody
                        });
                        return await response.json();
                    }
                    this.createLoader = function () {
                        const parentNode = document.getElementById('parent_lineChart')
                        //this.createPieDiv()
                        const canvas_piechart =  document.getElementById('canvas_piechart')
                        const canvas_piechart1 = document.getElementById('canvas_piechart1')
                        parentNode.style.position = 'relative';
                        canvas_piechart.style.position = 'relative';
                        canvas_piechart1.style.position = 'relative';
                        const spinner = document.createElement('img')
                        const spinner1 = document.createElement('img')
                        const spinner2 = document.createElement('img')
                        spinner1.id = 'loader1'
                        spinner1.style.position = 'absolute'
                        spinner1.style.top = '50%'
                        spinner1.style.left = '50%'
                        spinner1.style.width = '50px'
                        spinner1.style.height = '50px'
                        spinner1.style.transform = 'translate(-50%, -50%)'
                        spinner1.src = './images/spinner.gif'
                        spinner2.id = 'loader2'
                        spinner2.style.position = 'absolute'
                        spinner2.style.top = '50%'
                        spinner2.style.left = '50%'
                        spinner2.style.width = '50px'
                        spinner2.style.height = '50px'
                        spinner2.style.transform = 'translate(-50%, -50%)'
                        spinner2.src = './images/spinner.gif'
                        canvas_piechart.appendChild(spinner1)
                        canvas_piechart1.appendChild(spinner2)
                        spinner.id = 'loader'
                        spinner.style.position = 'absolute'
                        spinner.style.top = '50%'
                        spinner.style.left = '50%'
                        spinner.style.width = '50px'
                        spinner.style.height = '50px'
                        spinner.style.transform = 'translate(-50%, -50%)'
                        spinner.src = './images/spinner.gif'
                        parentNode.appendChild(spinner)
                    }

                    this.deleteLoader = function () {
                        document.getElementById('loader').remove()
                        document.getElementById('loader1').remove()
                        document.getElementById('loader2').remove()
                    }
                    this.getDateRange = async function (start, end, name, isCompressed, filterName, isAllFilters) {
                        this.dates = this.generateDataObject(this.getMs(start), this.getMs(end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });
                        this.createLoader()
                        try {
                            this.res = await this.fetchData(name);
                            this.allData = this.res.KPRESPONSE.CHART_DATA_LIST
                            

                           this.deleteLoader();
                           this.createMachineList();
                            if(isAllFilters) {
                             return  this.allFilters(window.allMachines || 'All Machines', window.machineLocation || 'All Location', start)
                            }
                            const filterData = this.filterByLocation(filterName)
                            this.topFive(filterData)
                            this.pieChartAllMachines(filterData)
                            this.displayData(isCompressed, start, true);
                        } catch (e) {
                           this.deleteLoader();
                            setTimeout(() => {
                                alert('Error in Api')
                            }, 0)
                        }
                    }
                    this.allFilters = function(machineFilters, locationFiltes) {

                        this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });

                        if((machineFilters === 'All Machines' || machineFilters === undefined) && (locationFiltes === undefined || locationFiltes === 'All Location') ) {
                            this.allData.map((el) => {
                            Object.keys(this.dates).map(item => {
                                if (item === el.TXN_DATE) {
                                    return this.dates = {
                                    ...this.dates,
                                    [item]: {
                                        APP_SALES: +this.dates[item].APP_SALES + +el.APP_SALES,
                                        CASH_SALES: +this.dates[item].CASH_SALES + +el
                                            .CASH_SALES,
                                        CONTACTLESS_SALES: (+this.dates[item]
                                            .CONTACTLESS_SALES + +el.CONTACTLESS_SALES),
                                        date: this.dates[item].date
                                    }
                                }
                                }
                            });
                        });
                        let { ctx, pieCtx, pieCtx1 } = this.createCanvas();
                        this.displayData(true, new Date(window.start), true);
                        this.topFive(this.allData);
                        this.pieChartAllMachines(this.allData);
                        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                        const myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                        const myNewChart1 = new Chart(pieCtx, {type: 'pie', data: machineChart.pieDataMachines, options: window.pieOptions});
                        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
                        const myNewChart2 = new Chart(pieCtx1, {type: 'pie', data: machineChart.pieDataAllMachines, options: window.pieOptions});

                        // var myNewChart = new Chart(ctx, {type: 'pie', data: pieAll, options: pieOptions});
                        this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });


                        }


                        else if(locationFiltes === 'All Location' && machineFilters !== 'All Machines') {

                            this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });
                            let machine = this.machineList.filter(item => item.MACHINE_NAME + '(' + item.MACHINE_NUMBER + ')' == machineFilters);
                            this.allData.map((el) => {
                            Object.keys(this.dates).map(item => {
                                if (item === el.TXN_DATE && el.MACHINE_NUMBER === machine[0].MACHINE_NUMBER) {
                                    return this.dates = {
                                    ...this.dates,
                                    [item]: {
                                        APP_SALES: +this.dates[item].APP_SALES + +el.APP_SALES,
                                        CASH_SALES: +this.dates[item].CASH_SALES + +el
                                            .CASH_SALES,
                                        CONTACTLESS_SALES: (+this.dates[item]
                                            .CONTACTLESS_SALES + +el.CONTACTLESS_SALES),
                                        date: this.dates[item].date
                                    }
                                }
                                }
                            });
                        });
                        let { ctx, pieCtx, pieCtx1 } = this.createCanvas();
                        this.displayData(true, new Date(window.start) , false, true);
                        this.pieChartAllMachines(this.allData.filter(item => item.MACHINE_NUMBER == machineFilters));
                        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                        const myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                        console.log("OPTIONS", window.pieOptions);
                        const myNewChart1 = new Chart(pieCtx, {type: 'pie', data: machineChart.pieDataMachines, options: window.pieOptions});
                        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
                        const myNewChart2 = new Chart(pieCtx1, {type: 'pie', data: machineChart.pieDataAllMachines, options: window.pieOptions});
                        this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });

                        }

                        else if(locationFiltes !== 'All Location' && machineFilters === 'All Machines') {

                            this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });

                        const fitlerData =  this.allData.filter((el) => el.LOCATION_NAME === locationFiltes)
                        
                        fitlerData.map((el) => {
                            Object.keys(this.dates).map((item) => {
                            if (item === el.TXN_DATE) {
                                return this.dates = {
                                    ...this.dates,
                                    [item]: {
                                        APP_SALES: +this.dates[item].APP_SALES + +el.APP_SALES,
                                        CASH_SALES: +this.dates[item].CASH_SALES + +el
                                            .CASH_SALES,
                                        CONTACTLESS_SALES: (+this.dates[item]
                                            .CONTACTLESS_SALES + +el.CONTACTLESS_SALES),
                                        date: this.dates[item].date
                                    }
                                }
                            }
                        })
                        });
                        let { ctx, pieCtx, pieCtx1 } = this.createCanvas();
                        this.displayData(true, window.start , false, true);
                        this.topFive(fitlerData);
                        this.pieChartAllMachines(fitlerData);
                        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                        const myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                        console.log("OPTIONS", window.pieOptions);
                        const myNewChart1 = new Chart(pieCtx, {type: 'pie', data: machineChart.pieDataMachines, options: window.pieOptions});
                        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
                        const myNewChart2 = new Chart(pieCtx1, {type: 'pie', data: machineChart.pieDataAllMachines, options: window.pieOptions});
                        
                        this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });
                        }


                        else if(locationFiltes !== 'All Location' && machineFilters !== 'All Machines') {

                            this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });

                            const fitlerLocationData = this.allData.filter((el) => el.LOCATION_NAME === locationFiltes)
                            let machine = this.machineList.filter(item => item.MACHINE_NUMBER == machineFilters);
                            fitlerLocationData.map((el) => {
                            Object.keys(this.dates).map(item => {
                                if (item === el.TXN_DATE && el.MACHINE_NUMBER === machine[0].MACHINE_NUMBER) {
                                    return this.dates = {
                                    ...this.dates,
                                    [item]: {
                                        APP_SALES: +this.dates[item].APP_SALES + +el.APP_SALES,
                                        CASH_SALES: +this.dates[item].CASH_SALES + +el
                                            .CASH_SALES,
                                        CONTACTLESS_SALES: (+this.dates[item]
                                            .CONTACTLESS_SALES + +el.CONTACTLESS_SALES),
                                        date: this.dates[item].date
                                    }
                                }
                                }
                            });
                        });

                        let { ctx, pieCtx, pieCtx1 } = this.createCanvas();
                        this.displayData(true, window.start , false, true);
                        this.pieChartAllMachines(fitlerLocationData.filter(item => item.MACHINE_NUMBER === machineFilters));
                        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                        const myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                        console.log("OPTIONS", window.pieOptions);
                        const myNewChart1 = new Chart(pieCtx, {type: 'pie', data: machineChart.pieDataMachines, options: window.pieOptions});
                        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
                        const myNewChart2 = new Chart(pieCtx1, {type: 'pie', data: machineChart.pieDataAllMachines, options: window.pieOptions});

                        this.dates = this.generateDataObject(this.getMs(window.start), this.getMs(window.end), {
                            APP_SALES: 0,
                            CASH_SALES: 0,
                            CONTACTLESS_SALES: 0,
                            date: ''
                        });
                        }
                        else {
                                console.log('ERRR')
                        }
                    }





                    this.filterByLocation = function(filterName) {
                        if(filterName === 'All Location') return this.res.KPRESPONSE.CHART_DATA_LIST 
                        const fitlerData = this.res.KPRESPONSE.CHART_DATA_LIST.filter((el) => el.LOCATION_NAME === filterName)
                        return fitlerData
                    } 

                    this.topFive = function(filterData) {
                        let result = {}
                        filterData.forEach((machine) => {
                             
                            if(machine.MACHINE_NUMBER in result)  {
                                return result[machine.MACHINE_NUMBER] = {...result[machine.MACHINE_NUMBER], SUM: Number(result[machine.MACHINE_NUMBER].SUM || 0)  + Number(machine.CASH_SALES) + Number(machine.APP_SALES) + Number(machine.CONTACTLESS_SALES)}
                            }
                            else return result[machine.MACHINE_NUMBER] = machine
                        })

                        const arr = Object.values(result).sort((a,b) => Number(a.SUM) > Number(b.SUM)  ? -1 : 1 ).slice(0, 5);
                        console.log('TEST', arr);
                        const fiveMachines = document.getElementById('fiveMachines')
                        const isElem = document.getElementsByClassName('color_bgbox1')
                        let one, two, three, four, five, span1, span2, span3, span4, span5;

                         console.log(isElem)

                        if(!isElem.length) {
                            console.log(isElem)
                            one = document.createElement("li");
                            two = document.createElement("li");
                            three = document.createElement("li");
                            four = document.createElement("li");
                            five = document.createElement("li");

                            span1 = document.createElement("span");
                            span2 = document.createElement("span");
                            span3 = document.createElement("span");
                            span4 = document.createElement("span");
                            span5 = document.createElement("span");

                            one.classList.add("li");
                            two.classList.add("li");
                            three.classList.add("li");
                            four.classList.add("li");
                            five.classList.add("li");

                            span1.classList.add("span");
                            span2.classList.add("span");
                            span3.classList.add("span");
                            span4.classList.add("span");
                            span5.classList.add("span");

                        one.innerText = arr[0].MACHINE_NAME
                        two.innerText = arr[1].MACHINE_NAME
                        three.innerText = arr[2].MACHINE_NAME
                        four.innerText = arr[3].MACHINE_NAME
                        five.innerText = arr[4].MACHINE_NAME

                        one.appendChild(span1)
                        two.append(span2)
                        three.append(span3)
                        four.append(span4)
                        five.append(span5)

                        one.classList.add('color_bgbox5');
                        two.classList.add('color_bgbox2');
                        three.classList.add('color_bgbox1');
                        four.classList.add('color_bgbox3');
                        five.classList.add('color_bgbox4');
                        
                        fiveMachines.append(one)
                        fiveMachines.append(two)
                        fiveMachines.append(three)
                        fiveMachines.append(four)
                        fiveMachines.append(five)

                        }else {
                            elementsLi = document.getElementsByClassName('li');
                            elementsSpan = document.getElementsByClassName('span')

                        elementsLi[0].innerText = arr[0].MACHINE_NAME
                        elementsLi[1].innerText = arr[1].MACHINE_NAME
                        elementsLi[2].innerText = arr[2].MACHINE_NAME
                        elementsLi[3].innerText = arr[3].MACHINE_NAME
                        elementsLi[4].innerText = arr[4].MACHINE_NAME

                        span1 = document.createElement("span");
                        span2 = document.createElement("span");
                        span3 = document.createElement("span");
                        span4 = document.createElement("span");
                        span5 = document.createElement("span");

                        elementsLi[0].appendChild(span1)
                        elementsLi[1].append(span2)
                        elementsLi[2].append(span3)
                        elementsLi[3].append(span4)
                        elementsLi[4].append(span5)

                        elementsLi[0].classList.add('color_bgbox5');
                        elementsLi[1].classList.add('color_bgbox2');
                        elementsLi[2].classList.add('color_bgbox1');
                        elementsLi[3].classList.add('color_bgbox3');
                        elementsLi[4].classList.add('color_bgbox4');

                        }

                        // one.innerText = arr[0].MACHINE_NAME
                        // two.innerText = arr[1].MACHINE_NAME
                        // three.innerText = arr[2].MACHINE_NAME
                        // four.innerText = arr[3].MACHINE_NAME
                        // five.innerText = arr[4].MACHINE_NAME


                        // one.classList.add('color_bgbox5');
                        // two.classList.add('color_bgbox2');
                        // three.classList.add('color_bgbox1');
                        // four.classList.add('color_bgbox3');
                        // five.classList.add('color_bgbox4');
                        
                        // fiveMachines.append(one)
                        // fiveMachines.append(two)
                        // fiveMachines.append(three)
                        // fiveMachines.append(four)
                        // fiveMachines.append(five)

                        // const pieData = [
                        //     {
                        //         value: arr[0].SUM,
                        //         color: "#CAF27D",
                        //         highlight: "#CAF27D",
                        //         //label: arr[0].MACHINE_NAME
                        //     },
                        //     {
                        //         value: arr[1].SUM,
                        //         color: "#7fff00",
                        //         highlight: "#7fff00",
                        //         //label: arr[1].MACHINE_NAME
                        //     },
                        //     {
                        //         value: arr[2].SUM,
                        //         color: "#FFFFFF",
                        //         highlight: "#FFFFFF",
                        //         //label: arr[2].MACHINE_NAME
                        //     },
                        //     {
                        //         value: arr[3].SUM,
                        //         color: "#00581E",
                        //         highlight: "#00581E",
                        //         //label: arr[3].MACHINE_NAME
                        //     },
                        //     {
                        //         value: arr[4].SUM,
                        //         color: "#8CD600",
                        //         highlight: "#8CD600",
                        //         //label: arr[4].MACHINE_NAME
                        //     }
                        // ];

                        const pieData = {
                            datasets: [{
                                data: [arr[0].SUM, arr[1].SUM, arr[2].SUM, arr[3].SUM, arr[4].SUM],
                                backgroundColor: ["#CAF27D", "#7fff00", "#FFFFFF", "#00581E", "#8CD600"]
                            }],
                            labels: [arr[0].MACHINE_NAME, arr[1].MACHINE_NAME, arr[2].MACHINE_NAME, arr[3].MACHINE_NAME, arr[4].MACHINE_NAME]
                        }
                        this.pieDataMachines = pieData;
                        console.log('PIE DATA MACHINES', this.pieDataMachines);
                        // this.res.KPRESPONSE.CHART_DATA_LIST.sort((a,b) => Number(a.CASH_SALES) > Number(b.CASH_SALES)  ? -1 : 1 )
                    }

                    this.pieChartAllMachines = function(filterData) {
                        let result = {
                            APP_CONTACTLESS_SALES: 0,
                            CASH_SALES: 0
                        }
                        filterData.map((machine) => {
                            return result = {...result, APP_CONTACTLESS_SALES: Number(result['APP_CONTACTLESS_SALES']) + Number(machine.APP_SALES) + Number(machine.CONTACTLESS_SALES), CASH_SALES:Number(result['CASH_SALES']) + Number(machine.CASH_SALES)}
                        })      
                        console.log(result)
                        // const pieData = [
                        //     {
                        //         value: result.APP_CONTACTLESS_SALES,
                        //         color: "#CAF27D",
                        //         highlight: "#CAF27D",
                        //         //label: arr[0].MACHINE_NAME
                        //     },
                        //     {
                        //         value: result.CASH_SALES,
                        //         color: "#7fff00",
                        //         highlight: "#7fff00",
                        //         //label: arr[1].MACHINE_NAME
                        //     },
                        // ];

                        const pieData = {
                            datasets: [{
                                data: [result.APP_CONTACTLESS_SALES, result.CASH_SALES],
                                backgroundColor: ["#CAF27D", "#7fff00"]
                            }],
                            labels: ['Cashless sale', 'Cash sale']
                        }

                        
                        this.pieDataAllMachines = pieData;
                        console.log('PIE DATA MACHINES', this.pieDataAllMachines);
                    }

                    this.generateDataObject = function (start, end, param) {
                        let daysBetween = 0;
                        daysBetween = Math.round((end - start) / 86400000) + 1;
                        const generateData = new Array(daysBetween).fill();
                        let dates = {};
                        let currentDate = start;
                        generateData.map((el, index) => {
                            dates = {
                                ...dates,
                                [this.getCorrectDateFormat(currentDate)]: {...param, date: this.getChartDateFormat(currentDate)}
                            }
                            currentDate += 86400000
                        })
                        return dates;
                    }
                    this.createMachineList = function () {
                        const map = new Map();
                        for (const item of this.res.KPRESPONSE.CHART_DATA_LIST) {
                            if (!map.has(item.MACHINE_NUMBER)) {
                                map.set(item.MACHINE_NUMBER, true);
                                this.machineList.push({
                                    ...item
                                });
                            }
                        }
                        //locations

                        let selectDOM = document.getElementById('machine_select');
                        let selectLocations = document.getElementById('locations');
                        let option;
                        let locationOption;

                        this.machineList.map(item => {
                            option = document.createElement("option");
                            option.value = item.MACHINE_NUMBER;
                            option.text = item.MACHINE_NAME + '(' + item.MACHINE_NUMBER + ')';
                            selectDOM.add(option);
                            if(!(item.LOCATION_NAME in window.locationObject)) {
                                window.locationObject[item.LOCATION_NAME] = item.LOCATION_NAME;
                                locationOption = document.createElement("option");
                                locationOption.value = item.LOCATION_NAME;
                                locationOption.text = item.LOCATION_NAME;
                                selectLocations.add(locationOption)
                            }
                        });
                        // [...selectLocations.children].for((el, index, arr) =>  {
                        //     if(el.innerText !== 'All Location' el.innerText === arr[index + 2] )
                        // })
                selectUpdate('custom-select');
                selectUpdate1('custom-select1');
        
                    }
                    this.redoneData = function (initialData) {
                        
                        let newDate = {};
                        const dateLength = Object.keys(this.dates).length;
                        Object.keys(this.dates).reduce((a, b, index) => {
                            console.log(this.dates[a].date)
                                if (index % this.skip === 0 && index !== 0) {
                                    newDate = {
                                        ...newDate,
                                        [a]: {
                                            APP_SALES: newDate[a].APP_SALES / this.skip,
                                            CASH_SALES: newDate[a].CASH_SALES / this.skip,
                                            CONTACTLESS_SALES: newDate[a].CONTACTLESS_SALES / this.skip,
                                            date: this.dates[a].date
                                        }
                                    }
                                    a = b
                                }
                                if (index % this.skip !== 0 && dateLength - 1 === index) {
                                    newDate = {
                                        ...newDate,
                                        [a]: {
                                            APP_SALES: newDate[a].APP_SALES / ((dateLength - 1) % this.skip),
                                            CASH_SALES: newDate[a].CASH_SALES / ((dateLength - 1) % this.skip),
                                            CONTACTLESS_SALES: newDate[a].CONTACTLESS_SALES / (dateLength - 1 %
                                                this.skip),
                                                date: this.dates[a].date
                                        }
                                    }
                                    a = b
                                }
                                newDate = {
                                    ...newDate,
                                    [a]: {
                                        APP_SALES: newDate[a] === undefined ? this.dates[b].APP_SALES :
                                            newDate[a].APP_SALES + this.dates[b].APP_SALES,
                                        CASH_SALES: newDate[a] === undefined ? this.dates[b].CASH_SALES :
                                            newDate[a].CASH_SALES + this.dates[b].CASH_SALES,
                                        CONTACTLESS_SALES: newDate[a] === undefined ? this.dates[b]
                                            .CONTACTLESS_SALES : newDate[a].CONTACTLESS_SALES + this.dates[b]
                                            .CONTACTLESS_SALES,
                                            date: this.dates[a].date
                                    }
        
                                }
                                return a
                            },
                            this.getCorrectDateFormat(this.getMs(initialData))
                        );
                        return newDate
                    }
                    this.displayData = function (isCompressed, initialData, flag, isAllData) {
                        if (flag) {
                            if(isAllData) {
                                this.allData.map((el) => {
                                Object.keys(this.dates).map((item) => {
                                    if (item === el.TXN_DATE) {
                                        return this.dates = {
                                            ...this.dates,
                                            [item]: {
                                                APP_SALES: +this.dates[item].APP_SALES + +el.APP_SALES,
                                                CASH_SALES: +this.dates[item].CASH_SALES + +el
                                                    .CASH_SALES,
                                                CONTACTLESS_SALES: +this.dates[item]
                                                    .CONTACTLESS_SALES + +el.CONTACTLESS_SALES,
                                                date: this.dates[item].date
                                            }
                                        }
                                    }
                                })
                            });
                            }else {
                                this.res.KPRESPONSE.CHART_DATA_LIST.map((el) => {
                                Object.keys(this.dates).map((item) => {
                                    if (item === el.TXN_DATE) {
                                        return this.dates = {
                                            ...this.dates,
                                            [item]: {
                                                APP_SALES: +this.dates[item].APP_SALES + +el.APP_SALES,
                                                CASH_SALES: +this.dates[item].CASH_SALES + +el
                                                    .CASH_SALES,
                                                CONTACTLESS_SALES: +this.dates[item]
                                                    .CONTACTLESS_SALES + +el.CONTACTLESS_SALES,
                                                date: this.dates[item].date
                                            }
                                        }
                                    }
                                })
                            });
                            }
                        }
                        if (isCompressed) this.dates = this.redoneData(initialData);
                        this.appSales = Object.keys(this.dates).map(el => this.dates[el].APP_SALES);
                        this.cashSales = Object.keys(this.dates).map(el => this.dates[el].CASH_SALES);
                        this.contactlessSales = Object.keys(this.dates).map(el => this.dates[el].CONTACTLESS_SALES);
                        this.sumSales = Object.keys(this.dates).map(el => this.dates[el].CONTACTLESS_SALES + this.dates[el].APP_SALES + this.dates[el].CASH_SALES);
                        this.chartDates = Object.keys(this.dates).map(el => this.dates[el].date);
                        console.log(this.chartDates, Object.keys(this.dates), isCompressed)
                        this.lineData = {
                            labels: this.chartDates,
                            datasets: [{
                                label: "App sales",
                                backgroundColor: "rgba(0,88,30,0.1)",
                                borderColor: "#00581E",
                                data: this.appSales
                            }, {
                                label: "Cash sales",
                                backgroundColor: "rgba(255,178,0,0.1)",
                                borderColor: "#FFB200",
                                data: this.cashSales
                            }, {
                                label: "Contactless sales",
                                backgroundColor: "rgba(140,214,0,0.1)",
                                borderColor: "#8CD600",
                                data: this.contactlessSales
                            }, {
                                label: "Total sales",
                                backgroundColor: "rgba(251,62,62,0.1)",
                                borderColor: "#f97f7f",
                                data: this.sumSales
                            }],
                        };
                    }
                    this.displayOneMachineData = async function (machineNumber, location) {
                        let machine;
                        if(!location) {
                            machine =  this.machineList.filter(item => item.MACHINE_NUMBER == machineNumber);
                        }else if(machineNumber === 'All Machines') {
                            machine  = this.res.KPRESPONSE.CHART_DATA_LIST.filter((el) => el.LOCATION_NAME === location)
                            machine.map((el) => {
                            Object.keys(this.dates).map(item => {
                                if (item === el.TXN_DATE) {
                                    return this.dates = {
                                        ...this.dates,
                                        [item]: {
                                            APP_SALES: +el.APP_SALES,
                                            CASH_SALES: +el.CASH_SALES,
                                            CONTACTLESS_SALES: +el.CONTACTLESS_SALES,
                                        }
                                    }
                                }
                            });
                        });
                        let { ctx, pieCtx, pieCtx1 } = this.createCanvas();
                        this.displayData(false, '2020-01-01', false);
                        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                        const myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                        const myNewChart1 = new Chart(pieCtx, {type: 'pie', data: machineChart.pieDataMachines, options: window.pieOptions});
                        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
                        const myNewChart2 = new Chart(pieCtx1, {type: 'pie', data: machineChart.pieDataAllMachines, options: window.pieOptions});
                        return;
                        }
                        else {
                            machine = this.machineList.filter(item => item.MACHINE_NUMBER == machineNumber && location === item.LOCATION_NAME);
                        }
                        this.res.KPRESPONSE.CHART_DATA_LIST.map((el) => {
                            Object.keys(this.dates).map(item => {
                                if (machine.length && item === el.TXN_DATE && el.MACHINE_NUMBER === machine[0].MACHINE_NUMBER) {
                                    return this.dates = {
                                        ...this.dates,
                                        [item]: {
                                            APP_SALES: +el.APP_SALES,
                                            CASH_SALES: +el.CASH_SALES,
                                            CONTACTLESS_SALES: +el.CONTACTLESS_SALES,
                                        }
                                    }
                                }
                            });
                        });
                        let { ctx, pieCtx, pieCtx1 } = this.createCanvas();
                        this.displayData(false, '2020-01-01', false);
                        // const myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                        const myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                        // const myNewChart1 = new Chart(pieCtx).Pie(machineChart.pieDataMachines, window.pieOptions);
                        const myNewChart1 = new Chart(pieCtx, {type: 'pie', data: machineChart.pieDataMachines, options: window.pieOptions});
                        // const myNewChart2 = new Chart(pieCtx1).Pie(machineChart.pieDataAllMachines, window.pieOptions);
                        const myNewChart2 = new Chart(pieCtx1, {type: 'pie', data: machineChart.pieDataAllMachines, options: window.pieOptions});
                    }
                    this.createCanvas = function () {
                        document.getElementById("lineChart").remove();
                        const canvas = document.createElement('canvas');
                        canvas.id = 'lineChart';
                        canvas.height = 250;
                        canvas.style.resize = 'both';
                        const div = document.getElementById("parent_lineChart").appendChild(canvas);
                        const ctx = document.getElementById('lineChart').getContext('2d');
                        document.getElementById("pieChart").remove();
                        document.getElementById("pieChart1").remove();
                        const pieCanvas = document.createElement('canvas');
                        const pieCanvas1 = document.createElement('canvas');
                        pieCanvas.id = 'pieChart';
                        pieCanvas.height = 180;
                        pieCanvas.width = 180;
                        pieCanvas1.id = 'pieChart1';
                        pieCanvas1.height = 180;
                        pieCanvas1.width = 180;
                        //canvas.style.resize = 'both';
                        const pieDiv = document.getElementById("canvas_piechart").appendChild(pieCanvas);
                        const pieDiv1 = document.getElementById("canvas_piechart1").appendChild(pieCanvas1);
                        const pieCtx = document.getElementById('pieChart').getContext('2d');
                        const pieCtx1 = document.getElementById('pieChart1').getContext('2d');
                        return {ctx, pieCtx, pieCtx1};
                    }
                }
        
                const skip = 7;
                window.machineChart = new MachineChart(skip);
                //document.getElementById('canvas_piechart').remove()
                window.start = moment().subtract(29, 'days')
                window.end = moment()
                window.locationObject = {}
                await window.machineChart.getDateRange(moment().subtract(29, 'days'), moment(), '30DAYS', true, 'All Location');
                window.machineChart.updateData = { start: moment().subtract(29, 'days'), end: moment(), dayName: '30DAYS' };
                
                pageSetUp()
        
                //----------------------DEPRECATED (OLD VERSION OF CHART JS)-------------------
        //         window.lineOptions = {
        //     ///Boolean - Whether grid lines are shown across the chart
            
        //     scaleShowGridLines: true,
        //     scaleGridLineColor: "rgba(0,0,0,.05)",
        //     //Number - Width of the grid lines
        //     scaleGridLineWidth: 1,
        //     //Boolean - Whether the line is curved between points
        //     bezierCurve: true,
        //     //Number - Tension of the bezier curve between points
        //     bezierCurveTension: 0.4,
        //     //Boolean - Whether to show a dot for each point
        //     pointDot: true,
        //     //Number - Radius of each point dot in pixels
        //     pointDotRadius: 4,
        //     //Number - Pixel width of point dot stroke
        //     pointDotStrokeWidth: 1,
        //     //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
        //     pointHitDetectionRadius: 20,
        //     //Boolean - Whether to show a stroke for datasets
        //     datasetStroke: true,
        //     //Number - Pixel width of dataset stroke
        //     datasetStrokeWidth: 3,
        //     //Boolean - Whether to fill the dataset with a colour
        //     datasetFill: true,
        //     //Boolean - Re-draw chart on page resize
        //     responsive: true,
        //     //String - A legend template
        // };
                //----------------------------------------
        
        
                //render chart
                // let canvas = document.getElementById("lineChart");
                // var ctx = canvas.getContext("2d");
                // var myNewChart = new Chart(ctx, {
                //     type: 'line',
                //     data: machineChart.lineData,
                //     options: window.lineOptions
                // });
                var ctx = document.getElementById("lineChart").getContext("2d");
                // var myNewChart = new Chart(ctx).Line(machineChart.lineData, window.lineOptions);
                var myNewChart = new Chart(ctx, {type: 'line', data: machineChart.lineData, options: window.lineOptions});
                    
        //         var pieOptions = {
        //     //Boolean - Whether we should show a stroke on each segment
        //     segmentShowStroke: true,
        //     //String - The colour of each segment stroke
        //     segmentStrokeColor: "#fff",
        //     //Number - The width of each segment stroke
        //     segmentStrokeWidth: 0,
        //     //Number - Amount of animation steps
        //     animationSteps: 100,
        //     //String - types of animation
        //     animationEasing: "easeOutBounce",
        //     //Boolean - Whether we animate the rotation of the Doughnut
        //     animateRotate: true,
        //     //Boolean - Whether we animate scaling the Doughnut from the centre
        //     animateScale: false,
        //     //Boolean - Re-draw chart on page resize
        //     responsive: true,
        //     //String - A legend template
        // };



        

        // render chart
        // const pieDiv = document.createElement("div");
        // pieDiv.style.position = 'relative';
        // pieDiv.className = 'canvas_piechart';
        // pieDiv.id = 'canvas_piechart';
        // const pieCanvas = document.createElement("canvas");
        // pieCanvas.id = 'pieChart'
        // pieCanvas.style.height = 180
        // pieCanvas.style.width = 180
        // pieDiv.appendChild(pieCanvas);     
        // document.getElementById('mainPieRightDiv').appendChild(pieDiv);      
        var ctx1 = document.getElementById("pieChart").getContext("2d");
        // var myNewChart1 = new Chart(ctx1).Pie(machineChart.pieDataMachines, pieOptions);
        var myNewChart1 = new Chart(ctx1, {type: 'pie', data: machineChart.pieDataMachines, options: pieOptions});

        // var pieData1 = [
        //     {
        //         value: 5000,
        //         color: "#00581E",
        //         highlight: "#00581E",
        //         label: "Grey"
        //     },
        //     {
        //         value: 2000,
        //         color: "#8CD600",
        //         highlight: "#8CD600",
        //         label: "Grey"
        //     }
        // ];
            var ctx2 = document.getElementById("pieChart1").getContext("2d");
            // var myNewChart = new Chart(ctx2).Pie(machineChart.pieDataAllMachines, pieOptions);
            var myNewChart = new Chart(ctx2, {type: 'pie', data: machineChart.pieDataAllMachines, options: pieOptions});
            
            
            })()
        </script>
    </html>
